#!/usr/bin/env bash

SOURCE="${BASH_SOURCE[0]}"

# While $SOURCE is a symlink, resolve it.
while [ -h "${SOURCE}" ]; do
  DIR="$( cd -P "$( dirname "${SOURCE}" )" && pwd )"
  SOURCE="$( readlink "${SOURCE}" )"

  # If $SOURCE was a relative symlink, so no '/' as prefix, need to resolve it relative to the symlink base directory.
  [[ ${SOURCE} != /* ]] && SOURCE="${DIR}/${SOURCE}"
done
DIR="$( cd -P "$( dirname "${SOURCE}" )" && pwd )"

cd "${DIR}/.."
ruby_version="$(cat .ruby-version)"
/usr/bin/env rvm "${ruby_version}" do passenger start --daemonize --address 127.0.0.1 --port 3000 --user tabcsi
